!function(a,b){"use strict";var c=document.getElementsByTagName("script"),d=c[c.length-1].src.split("?")[0],e=d.split("/").slice(0,-1).join("/")+"/",f={version:"2.3.1",B:1,W:-1,ERROR_REPORT:!0,DIR:e,lang:"en",i18n:{en:{}}};f.opera=-1!=navigator.userAgent.search(/(opera)(?:.*version)?[ \/]([\w.]+)/i),f.webkit=-1!=navigator.userAgent.search(/(webkit)[ \/]([\w.]+)/i),f.msie=-1!=navigator.userAgent.search(/(msie) ([\w.]+)/i),f.mozilla=-1!=navigator.userAgent.search(/(mozilla)(?:.*? rv:([\w.]+))?/i)&&!f.webkit&&!f.msie,f.t=function(a){var b=f.i18n[f.lang][a]||f.i18n.en[a];if(b){for(var c=1;c<arguments.length;c++)b=b.replace("$",arguments[c]);return b}return a},f.extendClass=function(a,b){return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.super=a,b},f.abstractMethod=function(){throw Error("unimplemented abstract method")},f.clone=function(a){if(a&&"object"==typeof a){var b=a.constructor==Array?[]:{};for(var c in a)b[c]=a[c]==a?a:f.clone(a[c]);return b}return a},f.filterHTML=function(a){return a&&"string"==typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};var g=function(c,d){var d=d||{};for(var e in d)this[e]=d[e];for(var e in f.Board.default)this[e]===b&&(this[e]=f.Board.default[e]);for(var e in g.themes.default)this.theme[e]===b&&(this.theme[e]=g.themes.default[e]);this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.init(),c.appendChild(this.element),this.pixelRatio=a.devicePixelRatio||1,this.width&&this.height?this.setDimensions(this.width,this.height):this.width?this.setWidth(this.width):this.height&&this.setHeight(this.height)};g.themes={},g.themes.old={shadowColor:"rgba(32,32,32,0.5)",shadowTransparentColor:"rgba(32,32,32,0)",shadowBlur:0,shadowSize:function(a){return a.shadowSize},markupBlackColor:"rgba(255,255,255,0.8)",markupWhiteColor:"rgba(0,0,0,0.8)",markupNoneColor:"rgba(0,0,0,0.8)",markupLinesWidth:function(a){return a.autoLineWidth?a.stoneRadius/7:a.lineWidth},gridLinesWidth:1,gridLinesColor:function(a){return"rgba(0,0,0,"+Math.min(1,a.stoneRadius/15)+")"},starColor:"#000",starSize:function(a){return a.starSize*(a.width/300+1)},stoneSize:function(a){return a.stoneSize*Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesBackgroundColor:"hsla(0, 50%, 50%, 0.3)",coordinatesColor:"hsla(0, 0%, 100%, 1)",font:function(a){return a.font},linesShift:.5},g.themes.default={shadowColor:"rgba(62,32,32,0.5)",shadowTransparentColor:"rgba(62,32,32,0)",shadowBlur:function(a){return.1*a.stoneRadius},shadowSize:1,markupBlackColor:"rgba(255,255,255,0.9)",markupWhiteColor:"rgba(0,0,0,0.7)",markupNoneColor:"rgba(0,0,0,0.7)",markupLinesWidth:function(a){return a.stoneRadius/8},gridLinesWidth:function(a){return a.stoneRadius/15},gridLinesColor:"#654525",starColor:"#531",starSize:function(a){return a.stoneRadius/8+1},stoneSize:function(a){return Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesBackgroundColor:"hsla(30, 40%, 40%, 1)",coordinatesColor:"hsla(30, 40%, 25%, 1)",font:"calibri",linesShift:.25};var h,i=function(a,b){return"function"==typeof b.theme[a]?b.theme[a](b):b.theme[a]},j={draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.beginPath();var f=i("shadowBlur",b),g=Math.max(0,e-.5),h=this.createRadialGradient(c-b.ls,d-b.ls,g-1-f,c-b.ls,d-b.ls,g+f);h.addColorStop(0,i("shadowColor",b)),h.addColorStop(1,i("shadowTransparentColor",b)),this.fillStyle=h,this.arc(c-b.ls,d-b.ls,g+f,0,2*Math.PI,!0),this.fill()},clear:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-1.1*e-b.ls,d-1.1*e-b.ls,2.2*e,2.2*e)}},k=function(a,b,c){return a.obj_arr[b][c][0].c==f.B?i("markupBlackColor",a):a.obj_arr[b][c][0].c==f.W?i("markupWhiteColor",a):i("markupNoneColor",a)},l=function(a,b,c){return a.obj_arr[b][c][0]&&a.obj_arr[b][c][0].c==f.W||a.obj_arr[b][c][0].c==f.B},m=function(a,b){var c;a[b].clear(),a[b].draw(a);for(var d=0;d<a.size;d++)for(var e=0;e<a.size;e++)for(var f in a.obj_arr[d][e])c=a.obj_arr[d][e][f].type?"string"==typeof a.obj_arr[d][e][f].type?g.drawHandlers[a.obj_arr[d][e][f].type]:a.obj_arr[d][e][f].type:a.stoneHandler,c[b]&&c[b].draw.call(a[b].getContext(a.obj_arr[d][e][f]),a.obj_arr[d][e][f],a);for(var f in a.obj_list){var c=a.obj_list[f].handler;c[b]&&c[b].draw.call(a[b].getContext(a.obj_list[f].args),a.obj_list[f].args,a)}},n=function(a,b,c,d,e,f,g,h){a.strokeStyle="rgba(64,64,64,0.2)",a.lineWidth=d/30*h,a.beginPath(),d-=Math.max(1,a.lineWidth);var i,j,b,k,l,m=b+d*Math.cos(e*Math.PI),n=c+d*Math.sin(e*Math.PI),o=b+d*Math.cos(f*Math.PI),p=c+d*Math.sin(f*Math.PI);o>m?(i=(p-n)/(o-m),j=Math.atan(i)):o==m?j=Math.PI/2:(i=(p-n)/(o-m),j=Math.atan(i)-Math.PI);var q=g*d;k=Math.sin(j)*q,l=Math.cos(j)*q;var r=m+k,s=n-l,t=o+k,u=p-l;a.moveTo(m,n),a.bezierCurveTo(r,s,t,u,o,p),a.stroke()},o=function(a){for(var b=a.angle,c=a.angle,d=0;d<a.lines.length;d++)b+=a.lines[d],c-=a.lines[d],n(a.ctx,a.x,a.y,a.radius,b,c,a.factor,a.thickness)};g.drawHandlers={NORMAL:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),g=b.stoneRadius;a.c==f.W?(c=this.createRadialGradient(d-2*g/5,e-2*g/5,g/3,d-g/5,e-g/5,5*g/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#aaa")):(c=this.createRadialGradient(d-2*g/5,e-2*g/5,1,d-g/5,e-g/5,4*g/5),c.addColorStop(0,"#666"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,g-.5),0,2*Math.PI,!0),this.fill()}},shadow:j},PAINTED:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),g=b.stoneRadius;a.c==f.W?(c=this.createRadialGradient(d-2*g/5,e-2*g/5,2,d-g/5,e-g/5,4*g/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#ddd")):(c=this.createRadialGradient(d-2*g/5,e-2*g/5,1,d-g/5,e-g/5,4*g/5),c.addColorStop(0,"#111"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,g-.5),0,2*Math.PI,!0),this.fill(),this.beginPath(),this.lineWidth=g/6,a.c==f.W?(this.strokeStyle="#999",this.arc(d+g/8,e+g/8,g/2,0,Math.PI/2,!1)):(this.strokeStyle="#ccc",this.arc(d-g/8,e-g/8,g/2,Math.PI,1.5*Math.PI)),this.stroke()}},shadow:j},GLOW:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),g=b.stoneRadius;a.c==f.W?(c=this.createRadialGradient(d-2*g/5,e-2*g/5,g/3,d-g/5,e-g/5,8*g/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#666")):(c=this.createRadialGradient(d-2*g/5,e-2*g/5,1,d-g/5,e-g/5,3*g/5),c.addColorStop(0,"#555"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,g-.5),0,2*Math.PI,!0),this.fill()}},shadow:j},SHELL:{stone:{draw:function(a,b){var c,d,e=b.stoneRadius;h=h||Math.ceil(9999999*Math.random()),c=b.getX(a.x),d=b.getY(a.y);var g;if(g=a.c==f.W?"#aaa":"#000",this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),a.c==f.W){var i=h%(3+a.x*b.size+a.y)%3,j=b.size*b.size+a.x*b.size+a.y,k=2/j*(h%j);o(0==i?{ctx:this,x:c,y:d,radius:e,angle:k,lines:[.1,.12,.11,.1,.09,.09,.09,.09],factor:.25,thickness:1.75}:1==i?{ctx:this,x:c,y:d,radius:e,angle:k,lines:[.1,.09,.08,.07,.06,.06,.06,.06,.06,.06,.06],factor:.2,thickness:1.5}:{ctx:this,x:c,y:d,radius:e,angle:k,lines:[.12,.14,.13,.12,.12,.12],factor:.3,thickness:2}),g=this.createRadialGradient(c-2*e/5,d-2*e/5,e/3,c-e/5,d-e/5,5*e/5),g.addColorStop(0,"rgba(255,255,255,0.9)"),g.addColorStop(1,"rgba(255,255,255,0)"),this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill()}else g=this.createRadialGradient(c+.4*e,d+.4*e,0,c+.5*e,d+.5*e,e),g.addColorStop(0,"rgba(32,32,32,1)"),g.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),g=this.createRadialGradient(c-.4*e,d-.4*e,1,c-.5*e,d-.5*e,1.5*e),g.addColorStop(0,"rgba(64,64,64,1)"),g.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill()}},shadow:j},MONO:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius,g=i("markupLinesWidth",b)||1;this.fillStyle=a.c==f.W?"white":"black",this.beginPath(),this.arc(c,d,Math.max(0,e-g),0,2*Math.PI,!0),this.fill(),this.lineWidth=g,this.strokeStyle="black",this.stroke()}}},CR:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||k(b,a.x,a.y),this.lineWidth=a.lineWidth||i("markupLinesWidth",b)||1,this.beginPath(),this.arc(c-b.ls,d-b.ls,e/2,0,2*Math.PI,!0),this.stroke()}}},LB:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius,f=a.font||i("font",b)||"";this.fillStyle=a.c||k(b,a.x,a.y),this.font=1==a.text.length?Math.round(1.5*e)+"px "+f:2==a.text.length?Math.round(1.2*e)+"px "+f:Math.round(e)+"px "+f,this.beginPath(),this.textBaseline="middle",this.textAlign="center",this.fillText(a.text,c,d,2*e)}},grid:{draw:function(a,b){if(!l(b,a.x,a.y)&&!a._nodraw){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-e,d-e,2*e,2*e)}},clear:function(a,b){l(b,a.x,a.y)||(a._nodraw=!0,m(b,"grid"),delete a._nodraw)}}},SQ:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=Math.round(b.stoneRadius);this.strokeStyle=a.c||k(b,a.x,a.y),this.lineWidth=a.lineWidth||i("markupLinesWidth",b)||1,this.beginPath(),this.rect(Math.round(c-e/2)-b.ls,Math.round(d-e/2)-b.ls,e,e),this.stroke()}}},TR:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||k(b,a.x,a.y),this.lineWidth=a.lineWidth||i("markupLinesWidth",b)||1,this.beginPath(),this.moveTo(c-b.ls,d-b.ls-Math.round(e/2)),this.lineTo(Math.round(c-e/2)-b.ls,Math.round(d+e/3)+b.ls),this.lineTo(Math.round(c+e/2)+b.ls,Math.round(d+e/3)+b.ls),this.closePath(),this.stroke()}}},MA:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||k(b,a.x,a.y),this.lineCap="round",this.lineWidth=2*(a.lineWidth||i("markupLinesWidth",b)||1)-1,this.beginPath(),this.moveTo(Math.round(c-e/2),Math.round(d-e/2)),this.lineTo(Math.round(c+e/2),Math.round(d+e/2)),this.moveTo(Math.round(c+e/2)-1,Math.round(d-e/2)),this.lineTo(Math.round(c-e/2)-1,Math.round(d+e/2)),this.stroke(),this.lineCap="butt"}}},SL:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.fillStyle=a.c||k(b,a.x,a.y),this.beginPath(),this.rect(c-e/2,d-e/2,e,e),this.fill()}}},SM:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||k(b,a.x,a.y),this.lineWidth=2*(a.lineWidth||i("markupLinesWidth",b)||1),this.beginPath(),this.arc(c-e/3,d-e/3,e/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.arc(c+e/3,d-e/3,e/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.moveTo(c-e/1.5,d),this.bezierCurveTo(c-e/1.5,d+e/2,c+e/1.5,d+e/2,c+e/1.5,d),this.stroke()}}},outline:{stone:{draw:function(a,b){this.globalAlpha=a.alpha?a.alpha:.3,a.stoneStyle?g.drawHandlers[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b),this.globalAlpha=1}}},mini:{stone:{draw:function(a,b){b.stoneRadius=b.stoneRadius/2,a.stoneStyle?g.drawHandlers[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b),b.stoneRadius=2*b.stoneRadius}}}},g.coordinates={grid:{draw:function(a,b){var c,d,e,f,g,h;this.beginPath(),this.moveTo(0,0),this.lineTo(0,b.height),this.lineTo(b.width,b.height),this.lineTo(b.width,0),this.lineTo(0,0),this.closePath(),this.rect(b.fieldWidth,b.fieldHeight,Math.round(b.width-2*b.fieldWidth),Math.round(b.height-2*b.fieldHeight)),this.fillStyle=i("coordinatesBackgroundColor",b),this.fill(),this.clip(),this.save(),this.beginPath(),this.rect(b.fieldWidth,b.fieldHeight,Math.round(b.width-2*b.fieldWidth),Math.round(b.height-2*b.fieldHeight)),this.shadowColor="hsla(0, 0%, 0%, 0.2)",this.shadowBlur=b.fieldWidth/2,this.shadowOffsetX=b.fieldWidth/6,this.shadowOffsetY=b.fieldHeight/6,this.fill(),this.restore(),this.fillStyle=i("coordinatesColor",b),this.textBaseline="middle",this.textAlign="center",this.font=b.stoneRadius+"px "+(b.font||""),e=b.getX(-1.25),f=b.getX(b.size+.25),g=b.getY(-1.25),h=b.getY(b.size+.25);for(var j=0;j<b.size;j++)c=j+"A".charCodeAt(0),c>="I".charCodeAt(0)&&c++,d=b.getY(j),this.fillText(b.size-j,e,d),this.fillText(b.size-j,f,d),d=b.getX(j),this.fillText(String.fromCharCode(c),d,g),this.fillText(String.fromCharCode(c),d,h);this.fillStyle="black"}}},g.CanvasLayer=function(){this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.pixelRatio=a.devicePixelRatio||1,this.pixelRatio>1&&this.context.scale(this.pixelRatio,this.pixelRatio)},g.CanvasLayer.prototype={constructor:g.CanvasLayer,setDimensions:function(a,b){this.element.width=a,this.element.style.width=a/this.pixelRatio+"px",this.element.height=b,this.element.style.height=b/this.pixelRatio+"px"},appendTo:function(a,b){this.element.style.position="absolute",this.element.style.zIndex=b,a.appendChild(this.element)},removeFrom:function(a){a.removeChild(this.element)},getContext:function(){return this.context},draw:function(){},clear:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}},g.GridLayer=f.extendClass(g.CanvasLayer,function(){this.super.call(this)}),g.GridLayer.prototype.draw=function(a){var b;this.context.beginPath(),this.context.lineWidth=i("gridLinesWidth",a),this.context.strokeStyle=i("gridLinesColor",a);var c=Math.round(a.left),d=Math.round(a.top),e=Math.round(a.fieldWidth*(a.size-1)),f=Math.round(a.fieldHeight*(a.size-1));this.context.strokeRect(c-a.ls,d-a.ls,e,f);for(var g=1;g<a.size-1;g++)b=Math.round(a.getX(g))-a.ls,this.context.moveTo(b,d),this.context.lineTo(b,d+f),b=Math.round(a.getY(g))-a.ls,this.context.moveTo(c,b),this.context.lineTo(c+e,b);if(this.context.stroke(),this.context.fillStyle=i("starColor",a),a.starPoints[a.size])for(var h in a.starPoints[a.size])this.context.beginPath(),this.context.arc(a.getX(a.starPoints[a.size][h].x)-a.ls,a.getY(a.starPoints[a.size][h].y)-a.ls,i("starSize",a),0,2*Math.PI,!0),this.context.fill()},g.MultipleCanvasLayer=f.extendClass(g.CanvasLayer,function(){this.init(4)}),g.MultipleCanvasLayer.prototype.init=function(b){var c,d;this.layers=b,this.elements=[],this.contexts=[],this.pixelRatio=a.devicePixelRatio||1;for(var e=0;b>e;e++)c=document.createElement("canvas"),d=c.getContext("2d"),this.pixelRatio>1&&d.scale(this.pixelRatio,this.pixelRatio),this.elements.push(c),this.contexts.push(d)},g.MultipleCanvasLayer.prototype.appendTo=function(a,b){for(var c=0;c<this.layers;c++)this.elements[c].style.position="absolute",this.elements[c].style.zIndex=b,a.appendChild(this.elements[c])},g.MultipleCanvasLayer.prototype.removeFrom=function(a){for(var b=0;b<this.layers;b++)a.removeChild(this.elements[b])},g.MultipleCanvasLayer.prototype.getContext=function(a){return a.x%2?a.y%2?this.contexts[0]:this.contexts[1]:a.y%2?this.contexts[2]:this.contexts[3]},g.MultipleCanvasLayer.prototype.clear=function(){for(var a=0;a<this.layers;a++)this.contexts[a].clearRect(0,0,this.elements[a].width,this.elements[a].height)},g.MultipleCanvasLayer.prototype.setDimensions=function(a,b){for(var c=0;c<this.layers;c++)this.elements[c].width=a,this.elements[c].style.width=a/this.pixelRatio+"px",this.elements[c].height=b,this.elements[c].style.height=b/this.pixelRatio+"px"},g.ShadowLayer=f.extendClass(g.MultipleCanvasLayer,function(a,c){this.init(2),this.shadowSize=c===b?1:c,this.board=a}),g.ShadowLayer.prototype.getContext=function(a){return!(a.x%2&&a.y%2)&&(a.x%2||a.y%2)?this.contexts[1]:this.contexts[0]},g.ShadowLayer.prototype.setDimensions=function(a,b){this.super.prototype.setDimensions.call(this,a,b);for(var c=0;c<this.layers;c++)this.contexts[c].setTransform(1,0,0,1,Math.round(this.shadowSize*this.board.stoneRadius/7),Math.round(this.shadowSize*this.board.stoneRadius/7))};var p=function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-2*e-b.ls,d-2*e-b.ls,4*e,4*e)},q=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx},r=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty},s=function(){return 4*this.width/(4*(this.bx+1-this.tx)+2)},t=function(){return 4*this.height/(4*(this.by+1-this.ty)+2)},u=function(a,b){var c;for(var d in this.obj_arr[a][b]){c=this.obj_arr[a][b][d].type?"string"==typeof this.obj_arr[a][b][d].type?g.drawHandlers[this.obj_arr[a][b][d].type]:this.obj_arr[a][b][d].type:this.stoneHandler;for(var e in c)c[e].clear?c[e].clear.call(this[e].getContext(this.obj_arr[a][b][d]),this.obj_arr[a][b][d],this):p.call(this[e].getContext(this.obj_arr[a][b][d]),this.obj_arr[a][b][d],this)}},v=function(a,b){var c;for(var d in this.obj_arr[a][b]){c=this.obj_arr[a][b][d].type?"string"==typeof this.obj_arr[a][b][d].type?g.drawHandlers[this.obj_arr[a][b][d].type]:this.obj_arr[a][b][d].type:this.stoneHandler;for(var e in c)c[e].draw.call(this[e].getContext(this.obj_arr[a][b][d]),this.obj_arr[a][b][d],this)}},w=function(a){for(var b,c,d=0,e=0,f=this.grid.element;f&&"BODY"!=f.tagName;)d+=f.offsetTop,e+=f.offsetLeft,f=f.offsetParent;return b=a.pageX*this.pixelRatio,b-=e*this.pixelRatio,b-=this.left,b/=this.fieldWidth,b=Math.round(b),c=a.pageY*this.pixelRatio,c-=d*this.pixelRatio,c-=this.top,c/=this.fieldHeight,c=Math.round(c),{x:b>=this.size?-1:b,y:c>=this.size?-1:c}},x=function(){this.element.style.width=this.width/this.pixelRatio+"px",this.element.style.height=this.height/this.pixelRatio+"px",this.stoneRadius=i("stoneSize",this),this.ls=i("linesShift",this);for(var a in this.layers)this.layers[a].setDimensions(this.width,this.height)};g.prototype={constructor:g,init:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.obj_list=[],this.layers=[],this.listeners=[],this.element=document.createElement("div"),this.element.className="wgo-board",this.background&&("#"==this.background[0]?this.element.style.backgroundColor=this.background:this.element.style.backgroundImage="url('"+this.background+"')"),this.grid=new g.GridLayer,this.shadow=new g.ShadowLayer(this,i("shadowSize",this)),this.stone=new g.MultipleCanvasLayer,this.addLayer(this.grid,100),this.addLayer(this.shadow,200),this.addLayer(this.stone,300)},setWidth:function(a){this.width=a,this.width*=this.pixelRatio,this.fieldHeight=this.fieldWidth=s.call(this),this.left=q.call(this),this.height=(this.by-this.ty+1.5)*this.fieldHeight,this.top=r.call(this),x.call(this),this.redraw()},setHeight:function(a){this.height=a,this.height*=this.pixelRatio,this.fieldWidth=this.fieldHeight=t.call(this),this.top=r.call(this),this.width=(this.bx-this.tx+1.5)*this.fieldWidth,this.left=q.call(this),x.call(this),this.redraw()},setDimensions:function(a,b){this.width=a||parseInt(this.element.style.width,10),this.width*=this.pixelRatio,this.height=b||parseInt(this.element.style.height,10),this.height*=this.pixelRatio,this.fieldWidth=s.call(this),this.fieldHeight=t.call(this),this.left=q.call(this),this.top=r.call(this),x.call(this),this.redraw()},getSection:function(){return this.section},setSection:function(a,b,c,d){this.section="object"==typeof a?a:{top:a,right:b,bottom:c,left:d},this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()},setSize:function(a){var a=a||19;if(a!=this.size){this.size=a,this.obj_arr=[];for(var b=0;b<this.size;b++){this.obj_arr[b]=[];for(var c=0;c<this.size;c++)this.obj_arr[b][c]=[]}this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()}},redraw:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].clear(this),this.layers[a].draw(this);for(var a=0;a<this.size;a++)for(var b=0;b<this.size;b++)v.call(this,a,b);for(var c in this.obj_list){var d=this.obj_list[c].handler;for(var e in d)d[e].draw.call(this[e].getContext(this.obj_list[c].args),this.obj_list[c].args,this)}},getX:function(a){return this.left+a*this.fieldWidth},getY:function(a){return this.top+a*this.fieldHeight},addLayer:function(a,b){a.appendTo(this.element,b),a.setDimensions(this.width,this.height),this.layers.push(a)},removeLayer:function(a){var b=this.layers.indexOf(a);b>=0&&(this.layers.splice(b,1),a.removeFrom(this.element))},update:function(a){if(a.remove&&"all"==a.remove)this.removeAllObjects();else if(a.remove)for(var b in a.remove)this.removeObject(a.remove[b]);if(a.add)for(var b in a.add)this.addObject(a.add[b])},addObject:function(a){if(a.constructor!=Array){u.call(this,a.x,a.y);for(var b in this.obj_arr[a.x][a.y])if(this.obj_arr[a.x][a.y][b].type==a.type)return this.obj_arr[a.x][a.y][b]=a,void v.call(this,a.x,a.y);a.type?this.obj_arr[a.x][a.y].push(a):this.obj_arr[a.x][a.y].unshift(a),v.call(this,a.x,a.y)}else for(var b in a)this.addObject(a[b])},removeObject:function(a){if(a.constructor!=Array){for(var c,d=0;d<this.obj_arr[a.x][a.y].length;d++)if(this.obj_arr[a.x][a.y][d].type==a.type){c=d;break}c!==b&&(u.call(this,a.x,a.y),this.obj_arr[a.x][a.y].splice(c,1),v.call(this,a.x,a.y))}else for(var e in a)this.removeObject(a[e])},removeObjectsAt:function(a,b){this.obj_arr[a][b].length&&(u.call(this,a,b),this.obj_arr[a][b]=[])},removeAllObjects:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.redraw()},addCustomObject:function(a,b){this.obj_list.push({handler:a,args:b}),this.redraw()},removeCustomObject:function(a,b){for(var c in this.obj_list)if(this.obj_list[c].handler==a&&this.obj_list[c].args==b)return delete this.obj_list[c],this.redraw(),!0;return!1},addEventListener:function(a,b){var c=this,d={type:a,callback:b,handleEvent:function(a){var d=w.call(c,a);b(d.x,d.y,a)}};this.element.addEventListener(a,d,!0),this.listeners.push(d)},removeEventListener:function(a,b){for(var c in this.listeners)if(this.listeners[c].type==a&&this.listeners[c].callback==b)return this.element.removeEventListener(this.listeners[c].type,this.listeners[c],!0),delete this.listeners[c],!0;return!1},getState:function(){return{objects:f.clone(this.obj_arr),custom:f.clone(this.obj_list)}},restoreState:function(a){this.obj_arr=a.objects||this.obj_arr,this.obj_list=a.custom||this.obj_list,this.redraw()}},g.default={size:19,width:0,height:0,font:"Calibri",lineWidth:1,autoLineWidth:!1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:g.drawHandlers.SHELL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,left:0},background:f.DIR+"wood1.jpg",theme:{}},f.Board=g;var y=function(a){this.size=a||19,this.schema=[];for(var b=0;b<this.size*this.size;b++)this.schema[b]=0};y.prototype={constructor:f.Position,get:function(a,c){return 0>a||0>c||a>=this.size||c>=this.size?b:this.schema[a*this.size+c]},set:function(a,b,c){return this.schema[a*this.size+b]=c,this},clear:function(){for(var a=0;a<this.size*this.size;a++)this.schema[a]=0;return this},clone:function(){var a=new y(this.size);return a.schema=this.schema.slice(0),a},compare:function(a){for(var b=[],c=[],d=0;d<this.size*this.size;d++)this.schema[d]&&!a.schema[d]?c.push({x:Math.floor(d/this.size),y:d%this.size}):this.schema[d]!=a.schema[d]&&b.push({x:Math.floor(d/this.size),y:d%this.size,c:a.schema[d]});return{add:b,remove:c}}},f.Position=y;var z=function(a,c,d,e){this.size=a||19,this.repeating=c===b?"KO":c,this.allow_rewrite=d||!1,this.allow_suicide=e||!1,this.stack=[],this.stack[0]=new y(this.size),this.stack[0].capCount={black:0,white:0},this.turn=f.B,Object.defineProperty(this,"position",{get:function(){return this.stack[this.stack.length-1]},set:function(a){this[this.stack.length-1]=a}})},A=function(a,b,c,d,e){c>=0&&c<a.size&&d>=0&&d<a.size&&a.get(c,d)==e&&(a.set(c,d,0),b.push({x:c,y:d}),A(a,b,c,d-1,e),A(a,b,c,d+1,e),A(a,b,c-1,d,e),A(a,b,c+1,d,e))},B=function(a,b,c,d,e){return 0>c||c>=a.size||0>d||d>=a.size?!0:0==a.get(c,d)?!1:1==b.get(c,d)||a.get(c,d)==-e?!0:(b.set(c,d,!0),B(a,b,c,d-1,e)&&B(a,b,c,d+1,e)&&B(a,b,c-1,d,e)&&B(a,b,c+1,d,e))},C=function(a,b,c,d){var e=[];if(b>=0&&b<a.size&&c>=0&&c<a.size&&a.get(b,c)==d){var f=new y(a.size);B(a,f,b,c,d)&&A(a,e,b,c,d)}return e},D=function(a,b,c){var d,e;if("KO"==this.repeating&&this.stack.length-2>=0)e=this.stack.length-2;else{if("ALL"!=this.repeating)return!0;e=0}for(var f=this.stack.length-2;f>=e;f--)if(this.stack[f].get(b,c)==a.get(b,c)){d=!0;for(var g=0;g<this.size*this.size;g++)if(this.stack[f].schema[g]!=a.schema[g]){d=!1;break}if(d)return!1}return!0};z.prototype={constructor:z,getPosition:function(){return this.stack[this.stack.length-1]},play:function(a,b,c,d){if(!this.isOnBoard(a,b))return 1;if(!this.allow_rewrite&&0!=this.position.get(a,b))return 2;c||(c=this.turn);var e=this.position.clone();e.set(a,b,c);var g=c,h=C(e,a-1,b,-c).concat(C(e,a+1,b,-c),C(e,a,b-1,-c),C(e,a,b+1,-c));if(!h.length){var i=new y(this.size);if(B(e,i,a,b,c)){if(!this.allow_suicide)return 3;g=-c,A(e,h,a,b,c)}}return this.repeating&&!D.call(this,e,a,b)?4:d?!1:(e.color=c,e.capCount={black:this.position.capCount.black,white:this.position.capCount.white},g==f.B?e.capCount.black+=h.length:e.capCount.white+=h.length,this.pushPosition(e),this.turn=-c,h)},pass:function(a){this.pushPosition(),a?(this.position.color=a,this.turn=-a):(this.position.color=this.turn,this.turn=-this.turn)},isValid:function(a,b,c){return"number"!=typeof this.play(a,b,c,!0)},isOnBoard:function(a,b){return a>=0&&b>=0&&a<this.size&&b<this.size},addStone:function(a,b,c){return this.isOnBoard(a,b)&&0==this.position.get(a,b)?(this.position.set(a,b,c||0),!0):!1},removeStone:function(a,b){return this.isOnBoard(a,b)&&0!=this.position.get(a,b)?(this.position.set(a,b,0),!0):!1},setStone:function(a,b,c){return this.isOnBoard(a,b)?(this.position.set(a,b,c||0),!0):!1},getStone:function(a,b){return this.isOnBoard(a,b)?this.position.get(a,b):0},pushPosition:function(a){if(!a){var a=this.position.clone();a.capCount={black:this.position.capCount.black,white:this.position.capCount.white},a.color=this.position.color}return this.stack.push(a),a.color&&(this.turn=-a.color),this},popPosition:function(){var a=null;return this.stack.length>0&&(a=this.stack.pop(),this.turn=0==this.stack.length?f.B:this.position.color?-this.position.color:-this.turn),a},firstPosition:function(){return this.stack=[],this.stack[0]=new y(this.size),this.stack[0].capCount={black:0,white:0},this.turn=f.B,this},getCaptureCount:function(a){return a==f.B?this.position.capCount.black:this.position.capCount.white},validatePosition:function(){for(var a,b,c=0,d=0,e=[],g=this.position.clone(),h=0;h<this.size;h++)for(var i=0;i<this.size;i++)a=this.position.get(h,i),a&&(b=e.length,e=e.concat(C(g,h-1,i,-a),C(g,h+1,i,-a),C(g,h,i-1,-a),C(g,h,i+1,-a)),a==f.B?d+=e-b:c+=e-b);return this.position.capCount.black+=d,this.position.capCount.white+=c,this.position.schema=g.schema,e}},f.Game=z,a.WGo=f}(window),function(a,b){"use strict";var c=function(a){var b=new k(JSON.parse(JSON.stringify(a.getProperties())));for(var d in a.children)b.appendChild(c(a.children[d]));return b},d=function(a,c){var e;if(c[a]!==b)return c[a];for(var f in c.children)if(e=d(a,c.children[f]))return e;return!1},e=function(a,b){if(a.push(JSON.parse(JSON.stringify(b.getProperties()))),b.children.length>1){for(var c=[],d=0;d<b.children.length;d++){var f=[];e(f,b.children[d]),c.push(f)}a.push(c)}else b.children.length&&e(a,b.children[0])},f=function(a,b){for(var c,d=b,e=1;e<a.length;e++)if(a[e].constructor==Array)for(var g=0;g<a[e].length;g++)c=new k(a[e][g][0]),d.appendChild(c),f(a[e][g],c);else c=new k(a[e]),d.insertAfter(c),d=c},g=function(){this.size=19,this.info={},this.root=new k,this.nodeCount=0,this.propertyCount=0};g.prototype={constructor:g,clone:function(){var a=new g;return a.size=this.size,a.info=JSON.parse(JSON.stringify(this.info)),a.root=c(this.root),a.nodeCount=this.nodeCount,a.propertyCount=this.propertyCount,a},hasComments:function(){return!!d("comment",this.root)}},g.fromSgf=function(b){return a.SGF.parse(b)},g.fromJGO=function(a){var b="string"==typeof a?JSON.parse(a):a,c=new g;return c.info=JSON.parse(JSON.stringify(b.info)),c.size=b.size,c.nodeCount=b.nodeCount,c.propertyCount=b.propertyCount,c.root=new k(b.game[0]),f(b.game,c.root),c},g.prototype.toSgf=function(){},g.prototype.toJGO=function(a){var b={};return b.size=this.size,b.info=JSON.parse(JSON.stringify(this.info)),b.nodeCount=this.nodeCount,b.propertyCount=this.propertyCount,b.game=[],e(b.game,this.root),a?JSON.stringify(b):b};var h=function(b){var c;return b.name?(c=a.filterHTML(b.name),b.rank&&(c+=" ("+a.filterHTML(b.rank)+")"),b.team&&(c+=", "+a.filterHTML(b.team))):(b.team&&(c=a.filterHTML(b.team)),b.rank&&(c+=" ("+a.filterHTML(b.rank)+")")),c};g.infoFormatters={black:h,white:h,TM:function(b){if(0==b)return a.t("none");var c,d=Math.floor(b/60);return 1==d?c="1 "+a.t("minute"):d>1&&(c=d+" "+a.t("minutes")),d=b%60,1==d?c+=" 1 "+a.t("second"):d>1&&(c+=" "+d+" "+a.t("seconds")),c},RE:function(b){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+a.filterHTML(b)+'\'" title="'+a.t("res-show-tip")+'">'+a.t("show")+"</a>"}},g.infoList=["black","white","AN","CP","DT","EV","GN","GC","HA","ON","OT","RE","RO","RU","SO","TM","US","PC","KM"],a.Kifu=g;var i=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d].x==b.x&&a[d].y==b.y)return void(a[d][c]=b[c]);a.push(b)},j=function(a,b){if(a)for(var c=0;c<a.length;c++)if(a[c].x==b.x&&a[c].y==b.y)return void a.splice(c,1)},k=function(a,b){if(this.parent=b||null,this.children=[],a)for(var c in a)this[c]=a[c]};k.prototype={constructor:k,getChild:function(a){var b=a||0;return this.children[b]?this.children[b]:null},addSetup:function(a){return this.setup=this.setup||[],i(this.setup,a,"c"),this},removeSetup:function(a){return j(this.setup,a),this},addMarkup:function(a){return this.markup=this.markup||[],i(this.markup,a,"type"),this},removeMarkup:function(a){return j(this.markup,a),this},remove:function(){var a=this.parent;if(!a)throw new Exception("Root node cannot be removed");for(var b in a.children)if(a.children[b]==this){a.children.splice(b,1);break}return a.children=a.children.concat(this.children),this.parent=null,a},insertAfter:function(a){for(var b in this.children)this.children[b].parent=a;return a.children=a.children.concat(this.children),a.parent=this,this.children=[a],a},appendChild:function(a){return a.parent=this,this.children.push(a),a},getProperties:function(){var a={};for(var b in this)this.hasOwnProperty(b)&&"children"!=b&&"parent"!=b&&(a[b]=this[b]);return a}},a.KNode=k;var l=function(a,b){for(var c=a.size,d=[],e=[],f=0;c*c>f;f++)a.schema[f]&&!b.schema[f]?e.push({x:Math.floor(f/c),y:f%c}):a.schema[f]!=b.schema[f]&&d.push({x:Math.floor(f/c),y:f%c,c:b.schema[f]});return{add:d,remove:e}},m=function(b,c,d){this.kifu=b,this.node=this.kifu.root,this.allow_illegal=d||!1,this.game=new a.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal),this.path={m:0},this.kifu.info.HA&&this.kifu.info.HA>1&&(this.game.turn=a.W),this.change=p(this.game,this.node,!0),this.rememberPath=c?!0:!1},n=function(a,b){var c,d=[];for(var e in a){c=!0;for(var f in b)if(a[e].x==b[f].x&&a[e].y==b[f].y){c=!1;break}c&&d.push(a[e])}return d},o=function(a,b){a.add=n(a.add,b.remove).concat(b.add),a.remove=n(a.remove,b.add).concat(b.remove)},p=function(a,c,d){if(c.parent&&(c.parent._last_selected=c.parent.children.indexOf(c)),c.move!=b){if(c.move.pass)return a.pass(c.move.c),{add:[],remove:[]};var e=a.play(c.move.x,c.move.y,c.move.c);if("number"==typeof e)throw new t(e,c);for(var f in e)if(e[f].x==c.move.x&&e[f].y==c.move.y)return{add:[],remove:e};return{add:[c.move],remove:e}}d||a.pushPosition();var g=[],h=[];if(c.setup!=b)for(var f in c.setup)c.setup[f].c?(a.setStone(c.setup[f].x,c.setup[f].y,c.setup[f].c),g.push(c.setup[f])):(a.removeStone(c.setup[f].x,c.setup[f].y),h.push(c.setup[f]));return c.turn&&(a.turn=c.turn),{add:g,remove:h}},q=function(a){a===b&&this.rememberPath&&(a=this.node._last_selected),a=a||0;var c=this.node.children[a];if(!c)return!1;var d=p(this.game,c);
return this.path.m++,this.node.children.length>1&&(this.path[this.path.m]=a),this.node=c,d},r=function(){return this.node.parent?(this.node=this.node.parent,this.game.popPosition(),this.node.turn&&(this.game.turn=this.node.turn),this.path[this.path.m]!==b&&delete this.path[this.path.m],this.path.m--,!0):!1},s=function(){this.game.firstPosition(),this.node=this.kifu.root,this.path={m:0},this.kifu.info.HA&&this.kifu.info.HA>1&&(this.game.turn=a.W),this.change=p(this.game,this.node,!0)};m.prototype={constructor:m,next:function(a){return this.change=q.call(this,a),this},last:function(){var a;for(this.change={add:[],remove:[]};a=q.call(this);)o(this.change,a);return this},previous:function(){var a=this.game.getPosition();return r.call(this),this.change=l(a,this.game.getPosition()),this},first:function(){var a=this.game.getPosition();return s.call(this),this.change=l(a,this.game.getPosition()),this},goTo:function(a){if(a===b)return this;var c=this.game.getPosition();s.call(this);for(var d=0;d<a.m&&q.call(this,a[d+1]);d++);return this.change=l(c,this.game.getPosition()),this},previousFork:function(){for(var a=this.game.getPosition();r.call(this)&&1==this.node.children.length;);return this.change=l(a,this.game.getPosition()),this},getPosition:function(){return this.game.getPosition()},allowIllegalMoves:function(a){a?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}},a.KifuReader=m;var t=function(c,d){if(this.name="InvalidMoveError",this.message="Invalid move in kifu detected. ",d.move&&d.move.c!==b&&d.move.x!==b&&d.move.y!==b){var e=d.move.x;d.move.x>7&&e++,e=String.fromCharCode(e+65),this.message+="Trying to play "+(d.move.c==a.WHITE?"white":"black")+" move on "+String.fromCharCode(d.move.x+65)+(19-d.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(c)switch(c){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};t.prototype=new Error,t.prototype.constructor=t,a.InvalidMoveError=t,a.i18n.en.show="show",a.i18n.en["res-show-tip"]="Click to show result."}(WGo),function(a){a.SGF={};var b=function(a,b){return a.charCodeAt(b)-97},c=function(a,b,c,d,e,f){var g=f==b?"black":"white";c.info[g]=c.info[g]||{},c.info[g][a]=e[0]},d=a.SGF.properties={};d.B=d.W=function(c,d,e,f){d.move=!e[0]||c.size<=19&&"tt"==e[0]?{pass:!0,c:"B"==f?a.B:a.W}:{x:b(e[0],0),y:b(e[0],1),c:"B"==f?a.B:a.W}},d.AB=d.AW=function(c,d,e,f){for(var g in e)d.addSetup({x:b(e[g],0),y:b(e[g],1),c:"AB"==f?a.B:a.W})},d.AE=function(a,c,d){for(var e in d)c.addSetup({x:b(d[e],0),y:b(d[e],1)})},d.PL=function(b,c,d){c.turn="b"==d[0]||"B"==d[0]?a.B:a.W},d.C=function(a,b,c){b.comment=c.join()},d.LB=function(a,c,d){for(var e in d)c.addMarkup({x:b(d[e],0),y:b(d[e],1),type:"LB",text:d[e].substr(3)})},d.CR=d.SQ=d.TR=d.SL=d.MA=function(a,c,d,e){for(var f in d)c.addMarkup({x:b(d[f],0),y:b(d[f],1),type:e})},d.SZ=function(a,b,c){a.size=parseInt(c[0])},d.BR=d.WR=c.bind(this,"rank","BR"),d.PB=d.PW=c.bind(this,"name","PB"),d.BT=d.WT=c.bind(this,"team","BT"),d.TM=function(a,b,c,d){a.info[d]=c[0],b.BL=c[0],b.WL=c[0]};var e=/\(|\)|(;(\s*[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+)*)/g,f=/[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+/g,g=/[A-Z]+/,h=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;a.SGF.parse=function(b){var c,d,i,j,k=[],l=new a.Kifu,m=null;c=b.match(e);for(var n in c)if("("==c[n])k.push(m);else if(")"==c[n])m=k.pop();else{m&&l.nodeCount++,m=m?m.appendChild(new a.KNode):l.root,d=c[n].match(f)||[],l.propertyCount+=d.length;for(var o in d){j=g.exec(d[o])[0],i=d[o].match(h);for(var p in i)i[p]=i[p].substring(1,i[p].length-1).replace(/\\(?!\\)/g,"");a.SGF.properties[j]?a.SGF.properties[j](l,m,i,j):(i.length<=1&&(i=i[0]),m.parent?m[j]=i:l.info[j]=i)}}return l}}(WGo),function(a){"use strict";var b=function(a,b){this.name="FileError",this.message=1==b?"File '"+a+"' is empty.":2==b?"Network error. It is not possible to read '"+a+"'.":"File '"+a+"' hasn't been found on server."};b.prototype=new Error,b.prototype.constructor=b,a.FileError=b;var c=a.loadFromUrl=function(a,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState){if(200!=d.status)throw new b(a);if(0==d.responseText.length)throw new b(a,1);c(d.responseText)}};try{d.open("GET",a,!0),d.send()}catch(e){throw new b(a,2)}},d=function(b){b.change&&this.board.update(b.change),this.temp_marks&&this.board.removeObject(this.temp_marks);var c=[];if(this.notification(),b.node.move&&this.config.markLastMove&&(b.node.move.pass?this.notification(a.t((b.node.move.c==a.B?"b":"w")+"pass")):c.push({type:"CR",x:b.node.move.x,y:b.node.move.y})),b.node.children.length>1)for(var d=0;d<b.node.children.length;d++)b.node.children[d].move&&!b.node.children[d].move.pass&&c.push({type:"LB",text:String.fromCharCode(65+d),x:b.node.children[d].move.x,y:b.node.children[d].move.y,c:"rgba(0,32,128,0.8)"});if(b.node.markup){for(var d in b.node.markup)for(var e=0;e<c.length;e++)b.node.markup[d].x==c[e].x&&b.node.markup[d].y==c[e].y&&(c.splice(e,1),e--);c=c.concat(b.node.markup)}this.temp_marks=c,this.board.addObject(c)},e=function(a){this.board.setSize(a.kifu.size),this.board.removeAllObjects(),this.config.enableWheel&&this.setWheel(!0)},f=function(a,b){return a==b.element||a==b.element?!1:a._wgo_scrollable||a.scrollHeight>a.offsetHeight?!0:f(a.parentNode,b)},g=function(a){var b=a.wheelDelta||-1*a.detail;return f(a.target,this)?!0:0>b?(this.next(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):b>0?(this.previous(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):!0},h=function(a){if(document.querySelector(":focus"))return!0;switch(a.keyCode){case 39:this.next();break;case 37:this.previous();break;default:return!0}return this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll},i=function(a,b){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var c in this.kifuReader.node.children)if(this.kifuReader.node.children[c].move&&this.kifuReader.node.children[c].move.x==a&&this.kifuReader.node.children[c].move.y==b)return void this.next(c)},j=function(b){this.config=b;for(var c in j.default)void 0===this.config[c]&&void 0!==j.default[c]&&(this.config[c]=j.default[c]);this.element=document.createElement("div"),this.board=new a.Board(this.element,this.config.board),this.init(),this.initGame()};j.prototype={constructor:j,init:function(){this.kifu=null,this.listeners={kifuLoaded:[e.bind(this)],update:[d.bind(this)],frozen:[],unfrozen:[]},this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded),this.config.update&&this.addEventListener("update",this.config.update),this.config.frozen&&this.addEventListener("frozen",this.config.frozen),this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen),this.board.addEventListener("click",i.bind(this)),this.element.addEventListener("click",this.focus.bind(this)),this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(a){if(this.kifuReader&&this.kifuReader.change){var b={type:"update",op:a,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change};this.dispatchEvent(b)}},loadKifu:function(b,c){this.kifu=b,this.kifuReader=new a.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves),this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu}),this.update("init"),c&&this.goTo(c)},loadSgf:function(b,c){try{this.loadKifu(a.Kifu.fromSgf(b),c)}catch(d){this.error(d)}},loadJSON:function(b,c){try{this.loadKifu(a.Kifu.fromJGO(b),c)}catch(d){this.error(d)}},loadSgfFromFile:function(a,b){var d=this;try{c(a,function(a){d.loadSgf(a,b)})}catch(e){this.error(e)}},addEventListener:function(a,b){this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(b)},removeEventListener:function(a,b){if(this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!=c&&this.listeners[a].splice(c,1)}},dispatchEvent:function(a){if(this.listeners[a.type])for(var b in this.listeners[a.type])this.listeners[a.type][b](a)},notification:function(a){console&&console.log(a)},help:function(a){console&&console.log(a)},error:function(b){if(!a.ERROR_REPORT)throw b;console&&console.log(b)},next:function(a){if(!this.frozen&&this.kifu)try{this.kifuReader.next(a),this.update()}catch(b){this.error(b)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),this.update()}catch(a){this.error(a)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(a){this.error(a)}},first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(a){this.error(a)}},goTo:function(b){if(!this.frozen&&this.kifu){var c;"function"==typeof b&&(b=b.call(this)),"number"==typeof b?(c=a.clone(this.kifuReader.path),c.m=b||0):c=b;try{this.kifuReader.goTo(c),this.update()}catch(d){this.error(d)}}},getGameInfo:function(){if(!this.kifu)return null;var b={};for(var c in this.kifu.info)-1!=a.Kifu.infoList.indexOf(c)&&(b[a.t(c)]=a.Kifu.infoFormatters[c]?a.Kifu.infoFormatters[c](this.kifu.info[c]):a.filterHTML(this.kifu.info[c]));return b},setFrozen:function(a){this.frozen=a,this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(a){a.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(a){document.onkeydown=a?h.bind(this):null},setWheel:function(a){if(!this._wheel_listener&&a){this._wheel_listener=g.bind(this);var b=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";this.element.addEventListener(b,this._wheel_listener)}else if(this._wheel_listener&&!a){var b=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";this.element.removeEventListener(b,this._wheel_listener),delete this._wheel_listener}},setCoordinates:function(b){!this.coordinates&&b?(this.board.setSection(-1,-1,-1,-1),this.board.addCustomObject(a.Board.coordinates)):this.coordinates&&!b&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(a.Board.coordinates)),this.coordinates=b}},j.default={sgf:void 0,json:void 0,sgfFile:void 0,move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0},a.Player=j;var k={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."};for(var l in k)a.i18n.en[l]=k[l]}(WGo),function(WGo){"use strict";var pl_count=0,playerBlock=function(a,b,c){var d={};return d.element=document.createElement("div"),d.element.className="wgo-player-"+a,d.wrapper=document.createElement("div"),d.wrapper.className="wgo-player-"+a+"-wrapper",d.element.appendChild(d.wrapper),b.appendChild(d.element),c||(d.element.style.display="none"),d},BPgenerateDom=function(){this.dom={},this.dom.center=document.createElement("div"),this.dom.center.className="wgo-player-center",this.dom.board=document.createElement("div"),this.dom.board.className="wgo-player-board",this.regions={},this.regions.left=playerBlock("left",this.element),this.element.appendChild(this.dom.center),this.regions.right=playerBlock("right",this.element),this.regions.top=playerBlock("top",this.dom.center),this.dom.center.appendChild(this.dom.board),this.regions.bottom=playerBlock("bottom",this.dom.center)},getCurrentLayout=function(){var a=this.config.layout;if(a.constructor!=Array)return a;for(var b=this.height||this.maxHeight,c=0;c<a.length;c++)if(!a[c].conditions||(!a[c].conditions.minWidth||a[c].conditions.minWidth<=this.width)&&(!a[c].conditions.minHeight||!b||a[c].conditions.minHeight<=b)&&(!a[c].conditions.maxWidth||a[c].conditions.maxWidth>=this.width)&&(!a[c].conditions.maxHeight||!b||a[c].conditions.maxHeight>=b)&&(!a[c].conditions.custom||a[c].conditions.custom.call(this)))return a[c]},appendComponents=function(a){var b;if(b=this.currentLayout.layout?this.currentLayout.layout[a]:this.currentLayout[a]){this.regions[a].element.style.display="block",b.constructor!=Array&&(b=[b]);for(var c in b)this.components[b[c]]||(this.components[b[c]]=new BasicPlayer.component[b[c]](this)),this.components[b[c]].appendTo(this.regions[a].wrapper),this.components[b[c]]._detachFromPlayer=!1}else this.regions[a].element.style.display="none"},manageComponents=function(){for(var a in this.components)this.components[a]._detachFromPlayer=!0;appendComponents.call(this,"left"),appendComponents.call(this,"right"),appendComponents.call(this,"top"),appendComponents.call(this,"bottom");for(var a in this.components)this.components[a]._detachFromPlayer&&this.components[a].element.parentNode&&this.components[a].element.parentNode.removeChild(this.components[a].element)},BasicPlayer=WGo.extendClass(WGo.Player,function(a,b){this.config=b;for(var c in BasicPlayer.default)void 0===this.config[c]&&void 0!==BasicPlayer.default[c]&&(this.config[c]=BasicPlayer.default[c]);for(var c in WGo.Player.default)void 0===this.config[c]&&void 0!==WGo.Player.default[c]&&(this.config[c]=WGo.Player.default[c]);this.element=a,this.element.innerHTML="",this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main",this.element.className=this.classes,this.element.id||(this.element.id="wgo_"+pl_count++),BPgenerateDom.call(this),this.board=new WGo.Board(this.dom.board,this.config.board),this.init(),this.components={},window.addEventListener("resize",function(){this.noresize||this.updateDimensions()}.bind(this)),this.updateDimensions(),this.initGame()});BasicPlayer.prototype.appendTo=function(a){a.appendChild(this.element),this.updateDimensions()},BasicPlayer.prototype.updateDimensions=function(){for(var a=window.getComputedStyle(this.element),b=[];this.element.firstChild;)b.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);for(var c=parseInt(a.width),d=parseInt(a.height),e=parseInt(a.maxHeight)||0,f=0;f<b.length;f++)this.element.appendChild(b[f]);if(c!=this.width||d!=this.height||e!=this.maxHeight){this.width=c,this.height=d,this.maxHeight=e,this.currentLayout=getCurrentLayout.call(this),this.currentLayout&&this.lastLayout!=this.currentLayout&&(this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:this.classes,manageComponents.call(this),this.lastLayout=this.currentLayout);var g=this.dom.board.clientWidth,h=this.height||this.maxHeight;h&&(h-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight),h&&g>h?h!=this.board.height&&this.board.setHeight(h):g!=this.board.width&&this.board.setWidth(g);var i=h-g;i>0?(this.dom.board.style.height=h+"px",this.dom.board.style.paddingTop=i/2+"px"):(this.dom.board.style.height="auto",this.dom.board.style.paddingTop="0"),this.regions.left.element.style.height=this.dom.center.offsetHeight+"px",this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(var f in this.components)this.components[f].updateDimensions&&this.components[f].updateDimensions()}},BasicPlayer.prototype.showMessage=function(a,b,c){this.info_overlay=document.createElement("div"),this.info_overlay.style.width=this.element.offsetWidth+"px",this.info_overlay.style.height=this.element.offsetHeight+"px",this.info_overlay.className="wgo-info-overlay",this.element.appendChild(this.info_overlay);var d=document.createElement("div");d.className="wgo-info-message",d.innerHTML=a;var e=document.createElement("div");e.className="wgo-info-close",c||(e.innerHTML=WGo.t("BP:closemsg")),d.appendChild(e),this.info_overlay.appendChild(d),b?this.info_overlay.addEventListener("click",function(a){b(a)}):c||this.info_overlay.addEventListener("click",function(){this.hideMessage()}.bind(this)),this.setFrozen(!0)},BasicPlayer.prototype.hideMessage=function(){this.element.removeChild(this.info_overlay),this.setFrozen(!1)},BasicPlayer.prototype.error=function(a){if(!WGo.ERROR_REPORT)throw a;var b="#";switch(a.name){case"InvalidMoveError":this.showMessage("<h1>"+a.name+"</h1><p>"+a.message+"</p><p>If this message isn't correct, please report it by clicking <a href=\""+b+'">here</a>, otherwise contact maintainer of this site.</p>');break;case"FileError":this.showMessage("<h1>"+a.name+"</h1><p>"+a.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+a.name+"</h1><p>"+a.message+"</p><pre>"+a.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="'+b+'">here</a>.</p>')}},BasicPlayer.component={},BasicPlayer.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},minimal:{bottom:[]}},BasicPlayer.dynamicLayout=[{conditions:{minWidth:650},layout:BasicPlayer.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:BasicPlayer.layouts.one_column,className:"wgo-medium"},{conditions:{minWidth:350},layout:BasicPlayer.layouts.no_comment,className:"wgo-small"},{layout:BasicPlayer.layouts.no_comment,className:"wgo-xsmall"}],BasicPlayer.default={layout:BasicPlayer.dynamicLayout},WGo.i18n.en["BP:closemsg"]="click anywhere to close this window",BasicPlayer.attributes={"data-wgo":function(a){a&&("("==a[0]?this.sgf=a:this.sgfFile=a)},"data-wgo-board":function(value){this.board=eval("({"+value+"})")},"data-wgo-onkifuload":function(a){this.kifuLoaded=new Function(a)},"data-wgo-onupdate":function(a){this.update=new Function(a)},"data-wgo-onfrozen":function(a){this.frozen=new Function(a)},"data-wgo-onunfrozen":function(a){this.unfrozen=new Function(a)},"data-wgo-layout":function(value){this.layout=eval("({"+value+"})")},"data-wgo-enablewheel":function(a){"false"==a.toLowerCase()&&(this.enableWheel=!1)},"data-wgo-lockscroll":function(a){"false"==a.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(a){"false"==a.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(a){"false"==a.toLowerCase()&&(this.rememberPath=!1)},"data-wgo-allowillegal":function(a){"false"!=a.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(value){var m=parseInt(value);this.move=m?m:eval("({"+value+"})")},"data-wgo-marklastmove":function(a){"false"==a.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(a){a&&("("==a[0]?this.sgf=a:this.sgfFile=a,this.markLastMove=!1,this.enableKeys=!1,this.enableWheel=!1,this.layout={top:[],right:[],left:[],bottom:[]})}};var player_from_tag=function(a){var b,c,d;c={};for(var e=0;e<a.attributes.length;e++)b=a.attributes[e],BasicPlayer.attributes[b.name]&&BasicPlayer.attributes[b.name].call(c,b.value,b.name);d=new BasicPlayer(a,c),a._wgo_player=d};WGo.BasicPlayer=BasicPlayer,window.addEventListener("load",function(){for(var a=document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),b=0;b<a.length;b++)player_from_tag(a[b])})}(WGo),function(a){"use strict";var b=function(){this.element=document.createElement("div")};b.prototype={constructor:b,appendTo:function(a){a.appendChild(this.element)},getWidth:function(){var a=window.getComputedStyle(this.element);return parseInt(a.width)},getHeight:function(){var a=window.getComputedStyle(this.element);return parseInt(a.height)},updateDimensions:function(){}},a.BasicPlayer.component.Component=b}(WGo),function(){"use strict";var a=function(){b.call(this,"white"),b.call(this,"black"),this.element.appendChild(this.white.box),this.element.appendChild(this.black.box)},b=function(a){this[a]={};var b=this[a];b.box=document.createElement("div"),b.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+a,b.name=document.createElement("div"),b.name.className="wgo-box-title",b.name.innerHTML=a,b.box.appendChild(b.name);var d;d=document.createElement("div"),d.className="wgo-player-info",b.box.appendChild(d),b.info={},b.info.rank=c("rank"),b.info.rank.val.innerHTML="-",b.info.caps=c("caps"),b.info.caps.val.innerHTML="0",b.info.time=c("time"),b.info.time.val.innerHTML="--:--",d.appendChild(b.info.rank.wrapper),d.appendChild(b.info.caps.wrapper),d.appendChild(b.info.time.wrapper)},c=function(a){var b={};return b.wrapper=document.createElement("div"),b.wrapper.className="wgo-player-info-box-wrapper",b.box=document.createElement("div"),b.box.className="wgo-player-info-box",b.wrapper.appendChild(b.box),b.title=document.createElement("div"),b.title.className="wgo-player-info-title",b.title.innerHTML=WGo.t(a),b.box.appendChild(b.title),b.val=document.createElement("div"),b.val.className="wgo-player-info-value",b.box.appendChild(b.val),b},d=function(a){var b=a.kifu.info||{};b.black?(this.black.name.innerHTML=WGo.filterHTML(b.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(b.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-"),b.white?(this.white.name.innerHTML=WGo.filterHTML(b.white.name)||WGo.t("white"),this.white.info.rank.val.innerHTML=WGo.filterHTML(b.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),this.white.info.rank.val.innerHTML="-"),this.black.info.caps.val.innerHTML="0",this.white.info.caps.val.innerHTML="0",b.TM?(this.setPlayerTime("black",b.TM),this.setPlayerTime("white",b.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--"),this.updateDimensions()},e=function(a){var b,c,d;if(a.style.fontSize){var d=parseInt(a.style.fontSize);a.style.fontSize="",b=window.getComputedStyle(a),c=parseInt(b.fontSize),a.style.fontSize=d+"px"}else b=window.getComputedStyle(a),c=d=parseInt(b.fontSize);if(!(d==c&&a.scrollHeight<=a.offsetHeight))if(a.scrollHeight>a.offsetHeight)for(d-=2;a.scrollHeight>a.offsetHeight&&d>1;)a.style.fontSize=d+"px",d-=2;else if(c>d){for(d+=2;a.scrollHeight<=a.offsetHeight&&c>=d;)a.style.fontSize=d+"px",d+=2;a.scrollHeight>a.offsetHeight&&(a.style.fontSize=d-4+"px")}},f=function(a){a.node.BL&&this.setPlayerTime("black",a.node.BL),a.node.WL&&this.setPlayerTime("white",a.node.WL),void 0!==a.position.capCount.black&&(this.black.info.caps.val.innerHTML=a.position.capCount.black),void 0!==a.position.capCount.white&&(this.white.info.caps.val.innerHTML=a.position.capCount.white)},g=WGo.extendClass(WGo.BasicPlayer.component.Component,function(b){this.super(b),this.element.className="wgo-infobox",a.call(this),b.addEventListener("kifuLoaded",d.bind(this)),b.addEventListener("update",f.bind(this))});g.prototype.setPlayerTime=function(a,b){var c=Math.floor(b/60),d=Math.round(b)%60;this[a].info.time.val.innerHTML=c+":"+(10>d?"0"+d:d)},g.prototype.updateDimensions=function(){e(this.black.name),e(this.white.name)};var h=WGo.BasicPlayer.layouts;h.right_top.right.push("InfoBox"),h.right.right.push("InfoBox"),h.one_column.top.push("InfoBox"),h.no_comment.top.push("InfoBox"),WGo.i18n.en.rank="Rank",WGo.i18n.en.caps="Captures",WGo.i18n.en.time="Time",WGo.BasicPlayer.component.InfoBox=g}(WGo),function(a){"use strict";var b=function(){this.box=document.createElement("div"),this.box.className="wgo-box-wrapper wgo-comments-wrapper",this.element.appendChild(this.box),this.comments_title=document.createElement("div"),this.comments_title.className="wgo-box-title",this.comments_title.innerHTML=a.t("comments"),this.box.appendChild(this.comments_title),this.comments=document.createElement("div"),this.comments.className="wgo-comments-content",this.box.appendChild(this.comments),this.help=document.createElement("div"),this.help.className="wgo-help",this.help.style.display="none",this.comments.appendChild(this.help),this.notification=document.createElement("div"),this.notification.className="wgo-notification",this.notification.style.display="none",this.comments.appendChild(this.notification),this.comment_text=document.createElement("div"),this.comment_text.className="wgo-comment-text",this.comments.appendChild(this.comment_text)},c=function(a){var b,c;b=a.charCodeAt(0)-"a".charCodeAt(0),0>b&&(b+="a".charCodeAt(0)-"A".charCodeAt(0)),b>7&&b--,c=a.charCodeAt(1)-"0".charCodeAt(0),a.length>2&&(c=10*c+(a.charCodeAt(2)-"0".charCodeAt(0))),c=this.kifuReader.game.size-c,this._tmp_mark={type:"MA",x:b,y:c},this.board.addObject(this._tmp_mark)},d=function(){this.board.removeObject(this._tmp_mark),delete this._tmp_mark},e=function(a,b){for(var f in a)a[f].className&&"wgo-move-link"==a[f].className?(a[f].addEventListener("mouseover",c.bind(b,a[f].innerHTML)),a[f].addEventListener("mouseout",d.bind(b))):a[f].childNodes&&a[f].childNodes.length&&e(a[f].childNodes,b)},f=function(b,c){var d='<div class="wgo-info-list">';c&&(d+='<div class="wgo-info-title">'+a.t("gameinfo")+"</div>");for(var e in b)d+='<div class="wgo-info-item"><span class="wgo-info-label">'+e+'</span><span class="wgo-info-value">'+b[e]+"</span></div>";return d+="</div>"},g=a.extendClass(a.BasicPlayer.component.Component,function(c){this.super(c),this.player=c,this.element.className="wgo-commentbox",b.call(this),c.addEventListener("kifuLoaded",function(b){b.kifu.hasComments()?(this.comments_title.innerHTML=a.t("comments"),this.element.className="wgo-commentbox",this._update=function(a){this.setComments(a)}.bind(this),c.addEventListener("update",this._update)):(this.comments_title.innerHTML=a.t("gameinfo"),this.element.className="wgo-commentbox wgo-gameinfo",this._update&&(c.removeEventListener("update",this._update),delete this._update),this.comment_text.innerHTML=f(b.target.getGameInfo()))}.bind(this)),c.notification=function(a){a?(this.notification.style.display="block",this.notification.innerHTML=a,this.is_notification=!0):(this.notification.style.display="none",this.is_notification=!1),this.comment_text.style.display=this.is_notification||this.is_help?"none":"block"}.bind(this),c.help=function(a){a?(this.help.style.display="block",this.help.innerHTML=a,this.is_help=!0):(this.help.style.display="none",this.is_help=!1),this.comment_text.style.display=this.is_notification||this.is_help?"none":"block"}.bind(this)});g.prototype.setComments=function(a){this.player._tmp_mark&&d.call(this.player);var b="";a.node.parent||(b=f(a.target.getGameInfo(),!0)),this.comment_text.innerHTML=b+this.getCommentText(a.node.comment,this.player.config.formatNicks,this.player.config.formatMoves),this.player.config.formatMoves&&this.comment_text.childNodes&&this.comment_text.childNodes.length&&e(this.comment_text.childNodes,this.player)},g.prototype.getCommentText=function(b,c,d){if(b){var e="<p>"+a.filterHTML(b).replace(/\n/g,"</p><p>")+"</p>";return c&&(e=e.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ')),d&&(e=e.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>')),e}return""},a.BasicPlayer.default.formatNicks=!0,a.BasicPlayer.default.formatMoves=!0,a.BasicPlayer.attributes["data-wgo-formatnicks"]=function(a){"false"==a.toLowerCase()&&(this.formatNicks=!1)},a.BasicPlayer.attributes["data-wgo-formatmoves"]=function(a){"false"==a.toLowerCase()&&(this.formatMoves=!1)},a.BasicPlayer.layouts.right_top.right.push("CommentBox"),a.BasicPlayer.layouts.right.right.push("CommentBox"),a.BasicPlayer.layouts.one_column.bottom.push("CommentBox"),a.i18n.en.comments="Comments",a.i18n.en.gameinfo="Game info",a.BasicPlayer.component.CommentBox=g}(WGo),function(a){"use strict";var b=function(a){this.iconBar=document.createElement("div"),this.iconBar.className="wgo-control-wrapper",this.element.appendChild(this.iconBar);var b;for(var d in c.widgets)b=new c.widgets[d].constructor(a,c.widgets[d].args),b.appendTo(this.iconBar),this.widgets.push(b)},c=a.extendClass(a.BasicPlayer.component.Component,function(a){this.super(a),this.widgets=[],this.element.className="wgo-player-control",b.call(this,a)});c.prototype.updateDimensions=function(){this.element.className=this.element.clientWidth<340?"wgo-player-control wgo-340":this.element.clientWidth<440?"wgo-player-control wgo-440":"wgo-player-control"};var d=a.BasicPlayer.control={},e=function(a){a.node.parent||this.disabled?a.node.parent&&this.disabled&&this.enable():this.disable()},f=function(a){a.node.children.length||this.disabled?a.node.children.length&&this.disabled&&this.enable():this.disable()},g=function(){this._disabled=this.disabled,this.disabled||this.disable()},h=function(){this._disabled||this.enable(),delete this._disabled};d.Widget=function(a,b){this.element=this.element||document.createElement(b.type||"div"),this.element.className="wgo-widget-"+b.name,this.init(a,b)},d.Widget.prototype={constructor:d.Widget,init:function(a,b){b&&(b.disabled&&this.disable(),b.init&&b.init.call(this,a))},appendTo:function(a){a.appendChild(this.element)},disable:function(){this.disabled=!0,-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1,this.element.className=this.element.className.replace(" wgo-disabled",""),this.element.disabled=""}},d.Group=a.extendClass(d.Widget,function(a,b){this.element=document.createElement("div"),this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+b.name;var c;for(var d in b.widgets)c=new b.widgets[d].constructor(a,b.widgets[d].args),c.appendTo(this.element)}),d.Clickable=a.extendClass(d.Widget,function(a,b){this.super(a,b)}),d.Clickable.prototype.init=function(a,b){var c,d=this;c=b.togglable?function(){d.disabled||(b.click.call(d,a)?d.select():d.unselect())}:function(){d.disabled||b.click.call(d,a)},this.element.addEventListener("click",c),this.element.addEventListener("touchstart",function(a){return a.preventDefault(),c(),b.multiple&&(d._touch_i=0,d._touch_int=window.setInterval(function(){d._touch_i>500&&c(),d._touch_i+=100},100)),!1}),b.multiple&&this.element.addEventListener("touchend",function(){window.clearInterval(d._touch_int)}),b.disabled&&this.disable(),b.init&&b.init.call(this,a)},d.Clickable.prototype.select=function(){this.selected=!0,-1==this.element.className.search("wgo-selected")&&(this.element.className+=" wgo-selected")},d.Clickable.prototype.unselect=function(){this.selected=!1,this.element.className=this.element.className.replace(" wgo-selected","")},d.Button=a.extendClass(d.Clickable,function(b,c){var d=this.element=document.createElement("button");d.className="wgo-button wgo-button-"+c.name,d.title=a.t(c.name),this.init(b,c)}),d.Button.prototype.disable=function(){d.Button.prototype.super.prototype.disable.call(this),this.element.disabled="disabled"},d.Button.prototype.enable=function(){d.Button.prototype.super.prototype.enable.call(this),this.element.disabled=""},d.MenuItem=a.extendClass(d.Clickable,function(b,c){var d=this.element=document.createElement("div");d.className="wgo-menu-item wgo-menu-item-"+c.name,d.title=a.t(c.name),d.innerHTML=d.title,this.init(b,c)}),d.MoveNumber=a.extendClass(d.Widget,function(a){this.element=document.createElement("form"),this.element.className="wgo-player-mn-wrapper";var b=this.move=document.createElement("input");
b.type="text",b.value="0",b.maxlength=3,b.className="wgo-player-mn-value",this.element.appendChild(b),this.element.onsubmit=b.onchange=function(a){return a.goTo(this.getValue()),!1}.bind(this,a),a.addEventListener("update",function(a){this.setValue(a.path.m)}.bind(this)),a.addEventListener("kifuLoaded",this.enable.bind(this)),a.addEventListener("frozen",this.disable.bind(this)),a.addEventListener("unfrozen",this.enable.bind(this))}),d.MoveNumber.prototype.disable=function(){d.MoveNumber.prototype.super.prototype.disable.call(this),this.move.disabled="disabled"},d.MoveNumber.prototype.enable=function(){d.MoveNumber.prototype.super.prototype.enable.call(this),this.move.disabled=""},d.MoveNumber.prototype.setValue=function(a){this.move.value=a},d.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var i=function(a,b){function d(a,b){for(var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a;){if(c.bind(a)(b))return a;a=a.parentElement}return!1}if(a._menu_tmp)return void delete a._menu_tmp;if(!a.menu){a.menu=document.createElement("div"),a.menu.className="wgo-player-menu",a.menu.style.position="absolute",a.menu.style.display="none",this.element.parentElement.appendChild(a.menu);var e;for(var f in c.menu)e=new c.menu[f].constructor(a,c.menu[f].args,!0),e.appendTo(a.menu)}var g=!0;if(b&&(g=d(b.target,".wgo-player-menu")?!1:!0),g){if("none"!=a.menu.style.display)return a.menu.style.display="none",document.removeEventListener("click",a._menu_ev),delete a._menu_ev,this.unselect(),!1;a.menu.style.display="block";var h=this.element.offsetTop,j=this.element.offsetLeft;return this.element.parentElement.parentElement.parentElement.parentElement==a.regions.bottom.wrapper?(a.menu.style.left=j+"px",a.menu.style.top=h-a.menu.offsetHeight+1+"px"):(a.menu.style.left=j+"px",a.menu.style.top=h+this.element.offsetHeight+"px"),a._menu_ev=i.bind(this,a),a._menu_tmp=!0,document.addEventListener("click",a._menu_ev),!0}};c.menu=[{constructor:d.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(a){return a.setCoordinates(!a.coordinates),a.coordinates},init:function(a){a.coordinates&&this.select()}}}],c.widgets=[{constructor:d.Group,args:{name:"left",widgets:[{constructor:d.Button,args:{name:"menu",togglable:!0,click:i}}]}},{constructor:d.Group,args:{name:"right",widgets:[{constructor:d.Button,args:{name:"about",click:function(b){b.showMessage(a.t("about-text"))}}}]}},{constructor:d.Group,args:{name:"control",widgets:[{constructor:d.Button,args:{name:"first",disabled:!0,init:function(a){a.addEventListener("update",e.bind(this)),a.addEventListener("frozen",g.bind(this)),a.addEventListener("unfrozen",h.bind(this))},click:function(a){a.first()}}},{constructor:d.Button,args:{name:"multiprev",disabled:!0,multiple:!0,init:function(a){a.addEventListener("update",e.bind(this)),a.addEventListener("frozen",g.bind(this)),a.addEventListener("unfrozen",h.bind(this))},click:function(b){var c=a.clone(b.kifuReader.path);c.m-=10,b.goTo(c)}}},{constructor:d.Button,args:{name:"previous",disabled:!0,multiple:!0,init:function(a){a.addEventListener("update",e.bind(this)),a.addEventListener("frozen",g.bind(this)),a.addEventListener("unfrozen",h.bind(this))},click:function(a){a.previous()}}},{constructor:d.MoveNumber},{constructor:d.Button,args:{name:"next",disabled:!0,multiple:!0,init:function(a){a.addEventListener("update",f.bind(this)),a.addEventListener("frozen",g.bind(this)),a.addEventListener("unfrozen",h.bind(this))},click:function(a){a.next()}}},{constructor:d.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(a){a.addEventListener("update",f.bind(this)),a.addEventListener("frozen",g.bind(this)),a.addEventListener("unfrozen",h.bind(this))},click:function(b){var c=a.clone(b.kifuReader.path);c.m+=10,b.goTo(c)}}},{constructor:d.Button,args:{name:"last",disabled:!0,init:function(a){a.addEventListener("update",f.bind(this)),a.addEventListener("frozen",g.bind(this)),a.addEventListener("unfrozen",h.bind(this))},click:function(a){a.last()}}}]}}];var j=a.BasicPlayer.layouts;j.right_top.top.push("Control"),j.right.right.push("Control"),j.one_column.top.push("Control"),j.no_comment.bottom.push("Control"),j.minimal.bottom.push("Control");var k={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",multinext:"10 moves forward",last:"Last","switch-coo":"Display coordinates",menu:"Menu"};for(var l in k)a.i18n.en[l]=k[l];a.BasicPlayer.component.Control=c}(WGo),function(a){var b=function(a,b){this.player.frozen||this._lastX==a&&this._lastY==b||(this._lastX=a,this._lastY=b,this._last_mark&&this.board.removeObject(this._last_mark),-1!=a&&-1!=b&&this.player.kifuReader.game.isValid(a,b)?(this._last_mark={type:"outline",x:a,y:b,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},c=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)},d=function(a,b){for(var c=a.size,d=[],e=[],f=0;c*c>f;f++)a.schema[f]&&!b.schema[f]?e.push({x:Math.floor(f/c),y:f%c}):a.schema[f]!=b.schema[f]&&d.push({x:Math.floor(f/c),y:f%c,c:b.schema[f]});return{add:d,remove:e}};a.Player.Editable={},a.Player.Editable=function(a,b){this.player=a,this.board=b,this.editMode=!1},a.Player.Editable.prototype.set=function(e){!this.editMode&&e?(this.originalReader=this.player.kifuReader,this.player.kifuReader=new a.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,this.originalReader.allow_illegal),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||b.bind(this),this._ev_out=this._ev_out||c.bind(this),this.board.addEventListener("click",this._ev_click),this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out),this.editMode=!0):this.editMode&&!e&&(this.originalReader.goTo(this.player.kifuReader.path),this.originalReader.change=d(this.player.kifuReader.getPosition(),this.originalReader.getPosition()),this.player.kifuReader=this.originalReader,this.player.update(!0),this.board.removeEventListener("click",this._ev_click),this.board.removeEventListener("mousemove",this._ev_move),this.board.removeEventListener("mouseout",this._ev_out),this.editMode=!1)},a.Player.Editable.prototype.play=function(b,c){!this.player.frozen&&this.player.kifuReader.game.isValid(b,c)&&(this.player.kifuReader.node.appendChild(new a.KNode({move:{x:b,y:c,c:this.player.kifuReader.game.turn},edited:!0})),this.player.next(this.player.kifuReader.node.children.length-1))},a.BasicPlayer&&a.BasicPlayer.component.Control&&a.BasicPlayer.component.Control.menu.push({constructor:a.BasicPlayer.control.MenuItem,args:{name:"editmode",togglable:!0,click:function(b){return this._editable=this._editable||new a.Player.Editable(b,b.board),this._editable.set(!this._editable.editMode),this._editable.editMode},init:function(a){var b=this;a.addEventListener("frozen",function(){b._disabled=b.disabled,b.disabled||b.disable()}),a.addEventListener("unfrozen",function(){b._disabled||b.enable(),delete b._disabled})}}}),a.i18n.en.editmode="Edit mode"}(WGo),function(a){var b=function(a,b,c,d){this.originalPosition=a,this.position=a.clone(),this.board=b,this.komi=c,this.output=d},c=b.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4},d=function(a,b,c,e,f){var g=a.get(b,c);void 0!==g&&g!=e&&g!=f&&(a.set(b,c,e),d(a,b-1,c,e,f),d(a,b,c-1,e,f),d(a,b+1,c,e,f),d(a,b,c+1,e,f))},e=function(a,b,c,d,f){var g=b.get(c,d);a.get(c,d)!=g&&(a.set(c,d,g),e(a,b,c-1,d,f),e(a,b,c,d-1,f),e(a,b,c+1,d,f),e(a,b,c,d+1,f))};b.prototype.start=function(){this.calculate(),this.saved_state=this.board.getState(),this.displayScore(),this._click=function(b,f){var g=this.originalPosition.get(b,f);if(g==a.W)this.position.get(b,f)==c.WHITE_STONE?d(this.position,b,f,c.BLACK_CANDIDATE,c.BLACK_STONE):(e(this.position,this.originalPosition,b,f,c.BLACK_STONE),this.calculate());else if(g==a.B)this.position.get(b,f)==c.BLACK_STONE?d(this.position,b,f,c.WHITE_CANDIDATE,c.WHITE_STONE):(e(this.position,this.originalPosition,b,f,c.WHITE_STONE),this.calculate());else{var h=this.position.get(b,f);h==c.BLACK_CANDIDATE?this.position.set(b,f,c.BLACK_NEUTRAL):h==c.WHITE_CANDIDATE?this.position.set(b,f,c.WHITE_NEUTRAL):h==c.BLACK_NEUTRAL?this.position.set(b,f,c.BLACK_CANDIDATE):h==c.WHITE_NEUTRAL&&this.position.set(b,f,c.WHITE_CANDIDATE)}this.board.restoreState({objects:a.clone(this.saved_state.objects)}),this.displayScore()}.bind(this),this.board.addEventListener("click",this._click)},b.prototype.end=function(){this.board.restoreState({objects:a.clone(this.saved_state.objects)}),this.board.removeEventListener("click",this._click)},b.prototype.displayScore=function(){for(var b={black:[],white:[],neutral:[],black_captured:[],white_captured:[]},d=0;d<this.position.size;d++)for(var e=0;e<this.position.size;e++)s=this.position.get(d,e),t=this.originalPosition.get(d,e),s==c.BLACK_CANDIDATE?b.black.push({x:d,y:e,type:"mini",c:a.B}):s==c.WHITE_CANDIDATE?b.white.push({x:d,y:e,type:"mini",c:a.W}):s==c.NEUTRAL&&b.neutral.push({x:d,y:e}),t==a.W&&s!=c.WHITE_STONE?b.white_captured.push({x:d,y:e,type:"outline",c:a.W}):t==a.B&&s!=c.BLACK_STONE&&b.black_captured.push({x:d,y:e,type:"outline",c:a.B});for(var d=0;d<b.black_captured.length;d++)this.board.removeObjectsAt(b.black_captured[d].x,b.black_captured[d].y);for(var d=0;d<b.white_captured.length;d++)this.board.removeObjectsAt(b.white_captured[d].x,b.white_captured[d].y);this.board.addObject(b.white_captured),this.board.addObject(b.black_captured),this.board.addObject(b.black),this.board.addObject(b.white);var f="<p style='font-weight: bold;'>"+a.t("RE")+"</p>",g=b.black.length+b.white_captured.length+this.originalPosition.capCount.black,h=b.white.length+b.black_captured.length+this.originalPosition.capCount.white+parseFloat(this.komi);f+="<p>"+a.t("black")+": "+b.black.length+" + "+(b.white_captured.length+this.originalPosition.capCount.black)+" = "+g+"</br>",f+=a.t("white")+": "+b.white.length+" + "+(b.black_captured.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+h+"</p>",f+=g>h?"<p style='font-weight: bold;'>"+a.t("bwin",g-h)+"</p>":"<p style='font-weight: bold;'>"+a.t("wwin",h-g)+"</p>",this.output(f)},b.prototype.calculate=function(){var a,b,d,e,f,g;for(a=this.position,g=!0;g;){g=!1;for(var h=0;h<a.size;h++)for(var i=0;i<a.size;i++)if(b=a.get(i,h),b==c.UNKNOWN||b==c.BLACK_CANDIDATE||b==c.WHITE_CANDIDATE){d=[a.get(i-1,h),a.get(i,h-1),a.get(i+1,h),a.get(i,h+1)],e=!1,f=!1;for(var j=0;4>j;j++)d[j]==c.BLACK_STONE||d[j]==c.BLACK_CANDIDATE?e=!0:d[j]==c.WHITE_STONE||d[j]==c.WHITE_CANDIDATE?f=!0:d[j]==c.NEUTRAL&&(e=!0,f=!0);d=!1,e&&f?d=c.NEUTRAL:e?d=c.BLACK_CANDIDATE:f&&(d=c.WHITE_CANDIDATE),d&&b!=d&&(g=!0,a.set(i,h,d))}}},a.ScoreMode=b,a.BasicPlayer&&a.BasicPlayer.component.Control&&a.BasicPlayer.component.Control.menu.push({constructor:a.BasicPlayer.control.MenuItem,args:{name:"scoremode",togglable:!0,click:function(b){return this.selected?(b.setFrozen(!1),this._score_mode.end(),delete this._score_mode,b.notification(),b.help(),!1):(b.setFrozen(!0),b.help("<p>"+a.t("help_score")+"</p>"),this._score_mode=new a.ScoreMode(b.kifuReader.game.position,b.board,b.kifu.info.KM||.5,b.notification),this._score_mode.start(),!0)}}}),a.i18n.en.scoremode="Count score",a.i18n.en.score="Score",a.i18n.en.bwin="Black wins by $ points.",a.i18n.en.wwin="White wins by $ points.",a.i18n.en.help_score="Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."}(WGo),function(a){"use strict";var b={active:!0,query:{}},c=function(){try{b.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(a){b.query={}}};window.addEventListener("hashchange",function(){if(""!=window.location.hash&&b.active){c();for(var a in b.query){var e=document.getElementById(a);e&&e._wgo_player&&e._wgo_player.goTo(d)}}}),window.addEventListener("DOMContentLoaded",function(){""!=window.location.hash&&b.active&&c()}),window.addEventListener("load",function(){if(""!=window.location.hash&&b.active)for(var a in b.query){var c=document.getElementById(a);if(c&&c._wgo_player){c.scrollIntoView();break}}});var d=function(){return b.query[this.element.id]?b.query[this.element.id].goto:void 0};a.Player.default.move=d,a.BasicPlayer&&a.BasicPlayer.component.Control&&a.BasicPlayer.component.Control.menu.push({constructor:a.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(b){var c=location.href.split("#")[0]+"#"+b.element.id+'={"goto":'+JSON.stringify(b.kifuReader.path)+"}";b.showMessage("<h1>"+a.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+c+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}}),a.Player.permalink=b,a.i18n.en.permalink="Permanent link"}(WGo);